<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Little Bookshop</title>
  <link rel="stylesheet" href="./styles.css" />
  <link rel="icon" href="data:,">
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <span class="logo-dot" aria-hidden="true"></span>
      <h1>Little Bookshop</h1>
    </div>
    <nav class="nav">
      <a href="#/">Home</a>
      <a href="#/about">About</a>
      <a href="#/contact">Contact</a>
    </nav>
  </header>

  <main id="app"></main>

  <!-- Vue (global) -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.prod.js"></script>
  <script>
    // --- Home page with search ---
    const Home = {
      data() {
        return {
          searchQuery: "",
          books: [
            { id: 1, title: "Velora Isle", author: "M. Williams", price: "R249", img: "https://picsum.photos/seed/book1/300/420", blurb: "A private island, forbidden secrets, and a love that changes everything." },
            { id: 2, title: "A Kingdom of Fire & Fate", author: "H. Renee", price: "R299", img: "https://picsum.photos/seed/book2/300/420", blurb: "A fallen prince and a fierce heroine in a slow-burn war of hearts." },
            { id: 3, title: "Hooked", author: "E. McIntire", price: "R279", img: "https://picsum.photos/seed/book3/300/420", blurb: "Dangerous obsessions and a romance that refuses to behave." },
            { id: 4, title: "Priest", author: "S. Simone", price: "R269", img: "https://picsum.photos/seed/book4/300/420", blurb: "Temptation, devotion, and a boundary-pushing love story." }
          ]
        };
      },
      computed: {
        filteredBooks() {
          const q = this.searchQuery.trim().toLowerCase();
          if (!q) return this.books;
          return this.books.filter(b =>
            b.title.toLowerCase().includes(q) ||
            b.author.toLowerCase().includes(q)
          );
        }
      },
      template: `
        <section class="page">
          <div class="intro card">
            <h2>Welcome to the Little Bookshop</h2>
            <p>Discover your next favourite story in our curated collection of contemporary and romance titles.</p>
            <div class="search-bar">
              <input
                v-model="searchQuery"
                type="search"
                class="input"
                placeholder="Search by title or author‚Ä¶"
                aria-label="Search books"
              />
              <span class="kbd">/</span>
            </div>
          </div>

          <h2 class="section-title">Featured Books</h2>
          <div class="book-grid">
            <article v-for="b in filteredBooks" :key="b.id" class="book-card card">
              <a :href="'#/book/' + b.id" class="book-cover" :aria-label="'View ' + b.title">
                <img :src="b.img" :alt="b.title + ' cover'" loading="lazy">
              </a>
              <div class="book-meta">
                <h3 class="book-title">
                  <a :href="'#/book/' + b.id">{{ b.title }}</a>
                </h3>
                <p class="book-author">{{ b.author }}</p>
                <p class="book-price">{{ b.price }}</p>
                <a :href="'#/book/' + b.id" class="btn btn-accent">View details</a>
              </div>
            </article>
          </div>

          <p v-if="filteredBooks.length === 0" class="muted">No books match your search.</p>
        </section>
      `,
      mounted() {
        // Keyboard shortcut: focus search with "/"
        window.addEventListener('keydown', (e) => {
          if (e.key === '/' && !['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) {
            e.preventDefault();
            const el = document.querySelector('.search-bar .input');
            el && el.focus();
          }
        });
      }
    };

    const About = {
      template: `
        <section class="page">
          <h2>About Us</h2>
          <p>A tiny shop with a big love for stories.</p>
        </section>
      `
    };

    const Contact = {
      template: `
        <section class="page">
          <h2>Contact</h2>
          <p>Email us at hello@littlebookshop.example</p>
        </section>
      `
    };

    const Book = {
      data() { return { book: null }; },
      created() {
        const id = Number(this.$route.params.id);
        this.book = this.findBook(id);
      },
      watch: {
        '$route.params.id'(next) {
          this.book = this.findBook(Number(next));
        }
      },
      methods: {
        findBook(id) {
          const books = [
            { id: 1, title: "Velora Isle", author: "M. Williams", price: "R249", img: "https://picsum.photos/seed/book1/600/840", blurb: "A private island, forbidden secrets, and a love that changes everything." },
            { id: 2, title: "A Kingdom of Fire & Fate", author: "H. Renee", price: "R299", img: "https://picsum.photos/seed/book2/600/840", blurb: "A fallen prince and a fierce heroine in a slow-burn war of hearts." },
            { id: 3, title: "Hooked", author: "E. McIntire", price: "R279", img: "https://picsum.photos/seed/book3/600/840", blurb: "Dangerous obsessions and a romance that refuses to behave." },
            { id: 4, title: "Priest", author: "S. Simone", price: "R269", img: "https://picsum.photos/seed/book4/600/840", blurb: "Temptation, devotion, and a boundary-pushing love story." }
          ];
          return books.find(b => b.id === id) || null;
        }
      },
      template: `
        <section class="page" v-if="book">
          <p><a href="#/" class="link">‚Üê Back to books</a></p>
          <div class="book-detail">
            <div class="detail-cover card">
              <img :src="book.img" :alt="book.title + ' cover'">
            </div>
            <div class="detail-meta">
              <h2 class="detail-title">{{ book.title }}</h2>
              <p class="detail-author">by {{ book.author }}</p>
              <p class="detail-price">{{ book.price }}</p>
              <p class="detail-blurb">{{ book.blurb }}</p>
              <div class="detail-actions">
                <a href="#/contact" class="btn btn-accent">Enquire</a>
                <a href="#/" class="btn btn-ghost">Keep browsing</a>
              </div>
            </div>
          </div>
        </section>
        <section v-else class="page">
          <h2>Book not found</h2>
          <p>Try going back to the <a href="#/" class="link">book list</a>.</p>
        </section>
      `
    };

    // Router
    const { createRouter, createWebHashHistory } = VueRouter;
    const router = createRouter({
      history: createWebHashHistory(),
      routes: [
        { path: "/", component: Home },
        { path: "/about", component: About },
        { path: "/contact", component: Contact },
        { path: "/book/:id", component: Book },
        { path: "/:pathMatch(.*)*", redirect: "/" }
      ]
    });

    // Root App with newsletter modal
    const App = {
      data() {
        return {
          showNewsletter: false,
          email: "",
          signedUp: false,
        };
      },
      template: `
        <div>
          <router-view></router-view>

          <!-- Newsletter Modal -->
          <div
            v-if="showNewsletter"
            class="modal-overlay"
            role="dialog"
            aria-modal="true"
            aria-labelledby="nl-title"
          >
            <div class="modal card">
              <button class="modal-close" @click="dismiss" aria-label="Close">√ó</button>
              <h3 id="nl-title" class="modal-title">Join our newsletter</h3>
              <p class="modal-text" v-if="!signedUp">
                Get new releases, staff picks, and exclusive offers‚Äîstraight to your inbox.
              </p>

              <form v-if="!signedUp" class="modal-form" @submit.prevent="signup">
                <input
                  v-model="email"
                  class="input"
                  type="email"
                  placeholder="Your email address"
                  required
                  aria-label="Email address"
                />
                <button class="btn btn-accent" type="submit">Subscribe</button>
              </form>

              <p v-else class="modal-text"><strong>Thank you!</strong> You‚Äôre on the list üíú</p>
            </div>
          </div>
        </div>
      `,
      mounted() {
        // Show after a short delay unless dismissed before
        if (!localStorage.getItem('newsletterDismissed')) {
          setTimeout(() => { this.showNewsletter = true; }, 1400);
        }
      },
      methods: {
        dismiss() {
          this.showNewsletter = false;
          localStorage.setItem('newsletterDismissed', '1');
        },
        signup() {
          this.signedUp = true;
          localStorage.setItem('newsletterDismissed', '1');
          // In a real app, you'd POST the email to your newsletter service here.
        }
      }
    };

    Vue.createApp(App).use(router).mount("#app");
  </script>
</body>
</html>
